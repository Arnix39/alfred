{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "ROS2: Build workspace",
            "detail": "Build workspace for host machine.",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "command": "colcon",
            "args": [
                "build",
                "--build-base",
                "build/host",
                "--install-base",
                "install/host",
                "--packages-skip-regex",
                "ros_gz",
                "--symlink-install",
                "--cmake-args",
                "-DCMAKE_EXPORT_COMPILE_COMMANDS=ON",
                "-DSYNTHETIC_BUILD:BOOL=ON",
                "--no-warn-unused-cli"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "problemMatcher": "$gcc"
        },
        {
            "label": "ROS2: Unit tests",
            "detail": "Run unit tests.",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "command": "colcon",
            "args": [
                "test",
                "--build-base",
                "build/host",
                "--install-base",
                "install/host",
                "--packages-skip-regex",
                "ros_gz"
            ],
            "group": {
                "kind": "test"
            }
        },
        {
            "label": "ROS2: Tests results",
            "detail": "Show unit tests results.",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "command": "colcon",
            "args": [
                "test-result",
                "--test-result-base",
                "build/host"
            ],
            "group": {
                "kind": "test"
            }
        },
        {
            "label": "ROS2: Run tests",
            "detail": "Run all unit tests and show results.",
            "type": "shell",
            "dependsOrder": "sequence",
            "dependsOn": [
                "ROS2: Build workspace",
                "ROS2: Unit tests",
                "ROS2: Tests results"
            ],
            "group": {
                "kind": "test",
                "isDefault": true
            }
        },
        {
            "label": "ROS2: Gazebo simulation",
            "detail": "Build workspace for simulation in Gazebo.",
            "type": "shell",
            "dependsOrder": "sequence",
            "dependsOn": [
                "ROS2: Build workspace",
                "ROS2: Gazebo bridge"
            ],
            "group": {
                "kind": "build",
            }
        },
        {
            "label": "Gazebo: Launch simulation",
            "detail": "Launch simulation in Gazebo.",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}/src/sim/sdf",
                "env": {
                    "GZ_SIM_RESOURCE_PATH": "${workspaceFolder}/src/sim/sdf"
                }
            },
            "command": "gz",
            "args": [
                "sim",
                "world.sdf"
            ]
        },
        {
            "label": "Gazebo: Run simulation",
            "detail": "Run simulation in Gazebo.",
            "type": "shell",
            "dependsOrder": "sequence",
            "dependsOn": [
                "ROS2: Gazebo simulation",
                "Gazebo: Launch simulation"
            ]
        },
        {
            "label": "Workspace: Clean host files",
            "detail": "Clean workspace for host build files.",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}",
            },
            "command": "colcon",
            "args": [
                "build",
                "--build-base",
                "build/host",
                "--install-base",
                "install/host",
                "--packages-skip-regex",
                "ros_gz",
                "--cmake-target",
                "clean"
            ]
        },
        {
            "label": "Workspace: Generate sysroot for target",
            "detail": "Generate sysroot for cross compilation for Raspberry Pi 3B+.",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}/cross_compile"
            },
            "command": "${workspaceFolder}/cross_compile/generate_sysroot.sh"
        },
        {
            "label": "ROS2: Build workspace for target",
            "detail": "Build workspace for Raspberry Pi 3B+.",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}",
                "env": {
                    "TARGET_ARCH": "aarch64",
                    "CROSS_COMPILE": "/usr/bin/aarch64-linux-gnu-",
                    "SYSROOT": "${workspaceFolder}/cross_compile/sysroot",
                    "ROS2_INSTALL_PATH": "${workspaceFolder}/install/target",
                    "PYTHON_SOABI": "cpython-310-aarch64-linux-gnu",
                    "CC": "/usr/bin/aarch64-linux-gnu-gcc",
                    "CXX": "/usr/bin/aarch64-linux-gnu-g++",
                    "CROSS_COMPILE_DIR": "${workspaceFolder}/cross_compile"
                }
            },
            "command": "colcon",
            "args": [
                "build",
                "--build-base",
                "build/target",
                "--install-base",
                "install/target",
                "--packages-skip-regex",
                "ros_gz",
                "--symlink-install",
                "--cmake-args",
                "-DCMAKE_VERBOSE_MAKEFILE:BOOL=ON",
                "-DCMAKE_TOOLCHAIN_FILE=${CROSS_COMPILE_DIR}/cmake-toolchains/generic_linux.cmake",
                "--no-warn-unused-cli"
            ],
            "group": {
                "kind": "build"
            },
            "problemMatcher": "$gcc"
        },
        {
            "label": "ROS2: Install on target",
            "detail": "Install application on Raspberry Pi 3B+.",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn": [
                "ROS2: Build workspace for target",
            ],
            "command": "rsync",
            "args": [
                "--delete",
                "--copy-links",
                "-av",
                "${workspaceFolder}/install/target/",
                "arnix@alfred:/home/arnix/Alfred/"
            ],
            "group": {
                "kind": "build"
            },
            "problemMatcher": "$gcc"
        },
        {
            "label": "ROS2: Copy src on target",
            "detail": "Copy source files on Raspberry Pi 3B+.",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}/src/"
            },
            "command": "rsync",
            "args": [
                "--exclude",
                "sim",
                "--delete",
                "--copy-links",
                "-av",
                ".",
                "arnix@alfred:/home/arnix/Alfred/src"
            ],
            "group": {
                "kind": "build"
            },
            "problemMatcher": "$gcc"
        },
        {
            "label": "Workspace: Clean target files",
            "detail": "Clean workspace for target build files.",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}",
                "env": {
                    "TARGET_ARCH": "aarch64",
                    "CROSS_COMPILE": "/usr/bin/aarch64-linux-gnu-",
                    "SYSROOT": "${workspaceFolder}/cross_compile/sysroot/",
                    "ROS2_INSTALL_PATH": "${workspaceFolder}/install/target",
                    "PYTHON_SOABI": "cpython-310-aarch64-linux-gnu",
                    "CC": "/usr/bin/aarch64-linux-gnu-gcc",
                    "CXX": "/usr/bin/aarch64-linux-gnu-g++",
                    "CROSS_COMPILE_DIR": "${workspaceFolder}/cross_compile"
                }
            },
            "command": "colcon",
            "args": [
                "build",
                "--build-base",
                "build/target",
                "--install-base",
                "install/target",
                "--packages-skip-regex",
                "ros_gz",
                "--cmake-target",
                "clean"
            ],
            "problemMatcher": []
        },
        {
            "label": "ROS2: Gazebo bridge",
            "detail": "Build ros_gz package.",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}",
                "env": {
                    "GZ_VERSION": "garden"
                }
            },
            "command": "colcon",
            "args": [
                "build",
                "--build-base",
                "build/host",
                "--install-base",
                "install/host",
                "--packages-up-to",
                "ros_gz",
                "--symlink-install"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "problemMatcher": "$gcc"
        },
        {
            "label": "Workspace: Purge",
            "detail": "Purge workspace by deleting all generated files.",
            "type": "shell",
            "command": "rm",
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "args": [
                "-fr",
                "build",
                "install",
                "log"
            ]
        }
    ]
}