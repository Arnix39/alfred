{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "ROS2: Build workspace",
            "detail": "Build workspace for host machine.",
            "type": "shell",
            "command": "colcon",
            "args": [
                "build",
                "--build-base",
                "host/build",
                "--install-base",
                "host/install",
                "--symlink-install",
                "--cmake-args",
                "-DCMAKE_EXPORT_COMPILE_COMMANDS=ON",
                "-DSYNTHETIC_BUILD:BOOL=ON"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "problemMatcher": "$gcc"
        },
        {
            "label": "ROS2: Generate sysroot for target",
            "detail": "Generate sysroot for cross compilation for Raspberry Pi 3B+.",
            "type": "shell",
            "command": "../scripts/generate_sysroot.sh",
            "args": [
                ".",
                "${CROSS_COMPILE_DIR}",
            ],
        },
        {
            "options": {
                "env": {
                  "TARGET_ARCH": "aarch64",
                  "TARGET_TRIPLE": "aarch64-linux-gnu",
                  "CC": "/usr/bin/aarch64-linux-gnu-gcc",
                  "CXX": "/usr/bin/aarch64-linux-gnu-g++",
                  "CROSS_COMPILE": "/usr/bin/aarch64-linux-gnu-",
                  "CROSS_COMPILE_DIR": "${workspaceFolder}/cross_compile",
                  "SYSROOT": "${workspaceFolder}/cross_compile/sysroot",
                  "ROS2_INSTALL_PATH": "${workspaceFolder}/target/install",
                  "PYTHON_SOABI": "cpython-310-aarch64-linux-gnu",
                }
            },
            "label": "ROS2: Build workspace for target",
            "detail": "Build workspace for Raspberry Pi 3B+.",
            "type": "shell",
            "command": "colcon",
            "args": [
                "build",
                "--build-base",
                "target/build",
                "--install-base",
                "target/install",
                "--symlink-install",
                "--cmake-args",
                "-DCMAKE_VERBOSE_MAKEFILE:BOOL=ON",
                "-DCMAKE_TOOLCHAIN_FILE=${CROSS_COMPILE_DIR}/cmake-toolchains/generic_linux.cmake"
            ],
            "group": {
                "kind": "build"
            },
        },
        {
            "label": "ROS2: Install on target",
            "detail": "Install workspace on Raspberry Pi 3B+.",
            "type": "shell",
            "command": "../scripts/install_on_Alfred.sh",
            "args": [
                "${workspaceFolder}/target",
            ],
        },
        {
            "label": "ROS2: Run tests",
            "detail": "Run all unit tests and show results.",
            "type": "shell",
            "command": "colcon test && colcon test-result --all",
            "group": {
                "kind": "test",
                "isDefault": true
            }
        },
        {
            "label": "ROS2: Clean host files",
            "detail": "Clean workspace for host build.",
            "type": "shell",
            "command": "colcon",
            "args": [
                "build",
                "--build-base",
                "host/build",
                "--install-base",
                "host/install",
                "--cmake-target",
                "clean"
            ],
        },
        {
            "options": {
                "env": {
                  "TARGET_ARCH": "aarch64",
                  "TARGET_TRIPLE": "aarch64-linux-gnu",
                  "CC": "/usr/bin/aarch64-linux-gnu-gcc",
                  "CXX": "/usr/bin/aarch64-linux-gnu-g++",
                  "CROSS_COMPILE": "/usr/bin/aarch64-linux-gnu-",
                  "CROSS_COMPILE_DIR": "${workspaceFolder}/cross_compile",
                  "SYSROOT": "${workspaceFolder}/cross_compile/sysroot",
                  "ROS2_INSTALL_PATH": "${workspaceFolder}/target/install",
                  "PYTHON_SOABI": "cpython-310-aarch64-linux-gnu",
                }
            },
            "label": "ROS2: Clean target files",
            "detail": "Clean workspace for target build.",
            "type": "shell",
            "command": "colcon",
            "args": [
                "build",
                "--build-base",
                "target/build",
                "--install-base",
                "target/install",
                "--cmake-target",
                "clean"
            ],
        },
        {
            "label": "ROS2: Purge",
            "detail": "Purge workspace by deleting all generated files.",
            "type": "shell",
            "command": "rm",
            "args": [
                "-fr",
                "host",
                "log",
                "target"
            ],
        },
        {
            "label": "OpenCV: Build",
            "detail": "Build a selection of OpenCV modules for host machine.",
            "type": "shell",
            "command": "../scripts/buildOpenCV.sh",
            "args": [
                "/home/arnix/src/opencv/opencv-4.x",
            ],
        },
    ]
}